(function($){var g='3.66';var h=$.browser;if(!h){var l=navigator.userAgent.toLowerCase();var m=/(msie) ([\w.]+)/.exec(l)||!/compatible/.test(l)&&/(mozilla)/.exec(l)||[];h={version:m[2]};h[m[1]]=true}$.taconite=function(a){processDoc(a)};$.taconite.debug=0;$.taconite.autodetect=true;$.taconite.defaults={cdataWrap:'div'};$.fn.replace=$.fn.replace||function(a){this.after(a);this.remove();return this};$.fn.replaceContent=$.fn.replaceContent||function(a){return this.empty().append(a)};$.expr[':'].taconiteTag=function(a){return a.taconiteTag===1};$.taconite.enableAutoDetection=function(b){$.taconite.autodetect=b;if(r)$.httpData=b?r:detect};var o=0;function log(){if(!$.taconite.debug||!window.console||!window.console.log)return;if(++o===1)log('Plugin Version: '+g);window.console.log('[taconite] '+[].join.call(arguments,''))}var p=$.parseJSON||function(s){return window['eval']('('+s+')')};function httpData(a,b,s){var c=a.getResponseHeader('content-type')||'',xml=b==='xml'||!b&&c.indexOf('xml')>=0,data=xml?a.responseXML:a.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){if($.error)$.error('parsererror')}if(s&&s.dataFilter){data=s.dataFilter(data,b)}if(typeof data==='string'){if(b==='json'||!b&&c.indexOf('json')>=0){data=p(data)}else if(b==="script"||!b&&c.indexOf("javascript")>=0){$.globalEval(data)}}return data}function getResponse(a,b,s){if(r)return r(a,b,s);return a.responseXML||a.responseText}function detect(a,b,s){var c=a.getResponseHeader('content-type');if($.taconite.debug){log('[AJAX response] content-type: ',c,';  status: ',a.status,' ',a.statusText,';  has responseXML: ',a.responseXML!==null);log('type arg: '+b)}var d=getResponse(a,b,s);if(d&&d.documentElement&&d.documentElement.nodeName!='parsererror'){$.taconite(d)}else if(typeof d=='string'){if(/taconite/.test(d))$.taconite(d)}else{log('jQuery core httpData returned: '+d);log('httpData: response is not XML (or not "valid" XML)')}return d}if($.ajaxPrefilter){$.ajaxPrefilter(function(d,e,f){f.success(function(a,b,c){if($.taconite.autodetect)detect(c,d.dataType,d)})})}var r=$.httpData;if($.httpData)$.httpData=detect;var u={'json':jsonParser},rawData,rawDataIndic;$.taconite.registerParser=function(a,b){u[a]=b};function parseRawData(a,b){var d=b,parser=u[a];if($.isFunction(parser))return parser(b);else throw'No parser registered for rawData of type "'+a+'"';}function jsonParser(a){return p(a)}function processDoc(a){var b=true,ex;try{if(typeof a=='string')a=convert(a);if(!(a&&a.documentElement)){log('$.taconite invoked without valid document; nothing to process');return false}var c=a.documentElement.tagName;log('XML document root: ',c);var d=$('taconite',a)[0];if(!d){log('document does not contain <taconite> element; nothing to process');return false}$.event.trigger('taconite-begin-notify',[d]);b=go(d)}catch(e){b=ex=e}if(rawDataIndic)$.event.trigger('taconite-rawdata-notify',[rawData]);$.event.trigger('taconite-complete-notify',[a,!!b,b===true?null:b]);if(ex)throw ex;}function convert(s){var a;log('attempting string to document conversion');try{if(window.DOMParser){var b=new DOMParser();a=b.parseFromString(s,'text/xml')}else{a=$("<xml>")[0];a.async='false';a.loadXML(s)}}catch(e){if(window.console&&window.console.error)window.console.error('[taconite] ERROR parsing XML string for conversion: '+e);throw e;}var c=a&&a.documentElement&&a.documentElement.tagName!='parsererror';log('conversion ',c?'successful!':'FAILED');return a}function go(a){try{var t=new Date().getTime();process(a.childNodes);$.taconite.lastTime=(new Date().getTime())-t;log('time to process response: '+$.taconite.lastTime+'ms')}catch(e){if(window.console&&window.console.error)window.console.error('[taconite] ERROR processing document: '+e);throw e;}return true}function process(b){rawData={};rawDataIndic=false;var c={wrap:1};var d=0;var a,n,v,i,j,js,els,raw,type,q,jq,cdataWrap,tmp;for(i=0;i<b.length;i++){if(b[i].nodeType!=1)continue;var e=b[i],cmd=e.tagName;if(cmd=='eval'){js=(e.firstChild?e.firstChild.nodeValue:null);log('invoking "eval" command: ',js);if(js)$.globalEval(js);continue}if(cmd=='rawData'){raw=(e.firstChild?e.firstChild.nodeValue:null);type=e.getAttribute('type');log('rawData ('+type+'): ',raw);var f=e.getAttribute('namespace')||'none';if(!rawData[f])rawData[f]=[];rawData[f].push({data:parseRawData(type,raw),type:type,name:e.getAttribute('name')||null,raw:raw});if(!rawDataIndic)rawDataIndic=true;continue}q=e.getAttribute('select');jq=$(q);if(!jq[0]){log('No matching targets for selector: ',q);continue}cdataWrap=e.getAttribute('cdataWrap')||$.taconite.defaults.cdataWrap;a=[];if(e.childNodes.length>0){d=1;for(j=0,els=[];j<e.childNodes.length;j++)els[j]=createNode(e.childNodes[j],cdataWrap);a.push(c[cmd]?cleanse(els):els)}n=e.getAttribute('name');v=e.getAttribute('value');if(n!==null)a.push(n);if(v!==null){tmp=Number(v);if(v==tmp)v=tmp;a.push(v)}for(j=1;true;j++){v=e.getAttribute('arg'+j);if(v===null)break;if(v.length){tmp=Number(v);if(v==tmp)v=tmp}a.push(v)}if($.taconite.debug)logCommand(q,cmd,a,els);jq[cmd].apply(jq,a)}if(d)postProcess()}function logCommand(q,b,a,c){var d='...';if(!c){d='';for(var k=0;k<a.length;k++){val=a[k];if(k>0)d+=',';if(typeof val=='string')d+=("'"+val+"'");else d+=val}}log("invoking command: $('",q,"').",b,'('+d+')')}function postProcess(){if(h.mozilla)return;$('select:taconiteTag').each(function(){var b=this;$('option:taconiteTag',this).each(function(){this.setAttribute('selected','selected');this.taconiteTag=null;if(b.type=='select-one'){var a=$('option',b).index(this);b.selectedIndex=a}});this.taconiteTag=null})}function cleanse(b){for(var i=0,a=[];i<b.length;i++)if(b[i].nodeType==1)a.push(b[i]);return a}function createNode(a,b){var c=a.nodeType;if(c==1)return createElement(a,b);if(c==3)return fixTextNode(a.nodeValue);if(c==4)return handleCDATA(a.nodeValue,b);return null}function handleCDATA(s,a){var b=document.createElement(a);var c=$(b)[a=='script'?'text':'html'](s);var d=c.children();if(d.size()==1)return d[0];return b}function fixTextNode(s){if(h.msie)s=s.replace(/\n/g,'\r').replace(/\s+/g,' ');return document.createTextNode(s)}function createElement(a,b){var e,tag=a.tagName.toLowerCase();if(h.msie&&h.version<9){var c=a.getAttribute('type');if(tag=='table'||c=='radio'||c=='checkbox'||tag=='button'||(tag=='select'&&a.getAttribute('multiple'))){e=document.createElement('<'+tag+' '+copyAttrs(null,a,true)+'>')}}if(!e){e=document.createElement(tag);copyAttrs(e,a)}if(h.msie&&tag=='td'){var d=a.getAttribute('colspan');if(d)e.colSpan=parseInt(d,10)}if(h.msie&&!e.canHaveChildren){if(a.childNodes.length>0)e.text=a.text}else{for(var i=0,max=a.childNodes.length;i<max;i++){var f=createNode(a.childNodes[i],b);if(f)e.appendChild(f)}}if(!h.mozilla){if(tag=='select'||(tag=='option'&&a.getAttribute('selected')))e.taconiteTag=1}return e}function copyAttrs(b,c,d){for(var i=0,attr='';i<c.attributes.length;i++){var a=c.attributes[i],n=$.trim(a.name),v=$.trim(a.value);if(d)attr+=(n+'="'+v+'" ');else if(n=='style'){b.style.cssText=v;b.setAttribute(n,v)}else $.attr(b,n,v)}return attr}})(jQuery);
